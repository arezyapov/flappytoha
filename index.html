<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="FlappyToha">
<link rel="apple-touch-icon" href="icon-180.png">
<link rel="manifest" href="manifest.json">
<title>Антон vs. КиШ</title>
<script>if ('serviceWorker' in navigator) navigator.serviceWorker.register('sw.js');</script>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  html, body {
    width: 100%; height: 100%;
    overflow: hidden;
    background: #000;
    font-family: -apple-system, 'SF Pro Display', 'Helvetica Neue', sans-serif;
    -webkit-user-select: none;
    user-select: none;
    cursor: default;
    touch-action: manipulation;
    -webkit-touch-callout: none;
    -webkit-tap-highlight-color: transparent;
  }
  canvas {
    display: block;
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
  }
</style>
</head>
<body>
<canvas id="c"></canvas>
<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');

// ── Responsive sizing ──
const DPR = window.devicePixelRatio || 1;
const GAME_RATIO = 500 / 750;
function resize() {
  const screenW = window.innerWidth, screenH = window.innerHeight;
  let w, h;
  if (screenW / screenH > GAME_RATIO) { h = screenH; w = h * GAME_RATIO; }
  else { w = screenW; h = w / GAME_RATIO; }
  canvas.style.width = w + 'px';
  canvas.style.height = h + 'px';
  canvas.width = 500 * DPR;
  canvas.height = 750 * DPR;
  ctx.setTransform(DPR, 0, 0, DPR, 0, 0);
}
resize();
window.addEventListener('resize', resize);

const W = 500, H = 750;

// ── Stars background ──
const stars = [];
for (let i = 0; i < 100; i++) {
  stars.push({
    x: Math.random() * W, y: Math.random() * H,
    r: Math.random() * 1.8 + 0.3,
    a: Math.random() * 0.6 + 0.2,
    speed: Math.random() * 0.03 + 0.01,
    phase: Math.random() * Math.PI * 2,
  });
}

// ── Load images ──
const birdImg = new Image(); birdImg.src = 'bird.png';
let birdLoaded = false; birdImg.onload = () => { birdLoaded = true; };

const runnerImgRaw = new Image(); runnerImgRaw.crossOrigin = 'anonymous';
runnerImgRaw.src = 'runner_char.png';
let runnerLoaded = false; let runnerImg = null;
runnerImgRaw.onload = () => {
  const oc = document.createElement('canvas');
  oc.width = runnerImgRaw.width; oc.height = runnerImgRaw.height;
  const ox = oc.getContext('2d');
  ox.drawImage(runnerImgRaw, 0, 0);
  const id = ox.getImageData(0, 0, oc.width, oc.height);
  const d = id.data;
  for (let i = 0; i < d.length; i += 4) {
    if (d[i] < 30 && d[i+1] < 30 && d[i+2] < 30) d[i+3] = 0;
  }
  ox.putImageData(id, 0, 0);
  runnerImg = oc;
  runnerLoaded = true;
};

// ── Zombie animation ──
let runnerFrame = 0, runnerTimer = 0;
const RUNNER_FRAMES = 10, RUNNER_FW = 2048 / 10, RUNNER_FH = 252;

// ── Doodle character ──
const doodleImgRaw = new Image(); doodleImgRaw.crossOrigin = 'anonymous';
doodleImgRaw.src = 'doodle_char.png';
let doodleLoaded = false; let doodleImg = null;
doodleImgRaw.onload = () => {
  const oc = document.createElement('canvas');
  oc.width = doodleImgRaw.width; oc.height = doodleImgRaw.height;
  const ox = oc.getContext('2d');
  ox.drawImage(doodleImgRaw, 0, 0);
  const id = ox.getImageData(0, 0, oc.width, oc.height);
  const d = id.data;
  for (let i = 0; i < d.length; i += 4) {
    if (d[i] < 30 && d[i+1] < 30 && d[i+2] < 30) d[i+3] = 0;
  }
  ox.putImageData(id, 0, 0);
  doodleImg = oc;
  doodleLoaded = true;
};
let doodleFrame = 0, doodleTimer = 0;
const DOODLE_FRAMES = 7, DOODLE_FW = 435, DOODLE_FH = 692;

// ── Buttons ──
const BTN_W = 320, BTN_H = 80, BTN_R = 16;
const BTN_X = W / 2 - BTN_W / 2;
const BTN1_Y = 260; // Охотник
const BTN2_Y = 360; // Мертвый анархист
const BTN3_Y = 460; // На краю

let hoverBtn = null;
let frame = 0;

// ── Draw ──
function draw() {
  frame++;

  // Background gradient
  const grad = ctx.createLinearGradient(0, 0, 0, H);
  grad.addColorStop(0, '#1a1a2e');
  grad.addColorStop(0.5, '#16213e');
  grad.addColorStop(1, '#0f3460');
  ctx.fillStyle = grad;
  ctx.fillRect(0, 0, W, H);

  // Stars
  for (const s of stars) {
    const twinkle = Math.sin(frame * s.speed + s.phase) * 0.3 + 0.7;
    ctx.globalAlpha = s.a * twinkle;
    ctx.fillStyle = '#fff';
    ctx.beginPath(); ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2); ctx.fill();
  }
  ctx.globalAlpha = 1;

  // Title
  ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
  ctx.fillStyle = '#fff'; ctx.font = 'bold 48px -apple-system, sans-serif';
  ctx.fillText('Антон vs. КиШ', W / 2, 120);

  // Subtitle
  ctx.fillStyle = 'rgba(255,255,255,0.4)'; ctx.font = '14px -apple-system, sans-serif';
  ctx.fillText('Выбери режим игры', W / 2, 168);

  // ── Button 1: Охотник ──
  drawButton(BTN_X, BTN1_Y, BTN_W, BTN_H, 'Охотник', 'Темнело за окном и наступала ночь...', '#ff6b6b', hoverBtn === 1);
  if (birdLoaded) {
    ctx.save();
    const bx = BTN_X + 46, by = BTN1_Y + BTN_H / 2;
    const bs = 42 + Math.sin(frame * 0.06) * 3;
    ctx.beginPath(); ctx.arc(bx, by, bs / 2, 0, Math.PI * 2); ctx.clip();
    ctx.drawImage(birdImg, bx - bs / 2, by - bs / 2, bs, bs);
    ctx.restore();
  }

  // ── Button 2: Мертвый анархист ──
  drawButton(BTN_X, BTN2_Y, BTN_W, BTN_H, 'Мертвый анархист', 'ХОЙ!', '#3c8cff', hoverBtn === 2);
  runnerTimer++;
  if (runnerTimer >= 6) { runnerTimer = 0; runnerFrame = (runnerFrame + 1) % RUNNER_FRAMES; }
  if (runnerLoaded) {
    const rx = BTN_X + 46, ry = BTN2_Y + BTN_H / 2;
    const rs = 50;
    ctx.drawImage(runnerImg, runnerFrame * RUNNER_FW, 0, RUNNER_FW, RUNNER_FH,
      rx - rs / 2, ry - rs / 2, rs, rs);
  }

  // ── Button 3: На краю ──
  drawButton(BTN_X, BTN3_Y, BTN_W, BTN_H, 'На краю', 'Хватит притворяться живым', '#f39c12', hoverBtn === 3);
  doodleTimer++;
  if (doodleTimer >= 6) { doodleTimer = 0; doodleFrame = (doodleFrame + 1) % DOODLE_FRAMES; }
  if (doodleLoaded) {
    const dx = BTN_X + 46, dy = BTN3_Y + BTN_H / 2;
    const ds = 55;
    ctx.drawImage(doodleImg, doodleFrame * DOODLE_FW, 0, DOODLE_FW, DOODLE_FH,
      dx - ds * 0.35, dy - ds / 2, ds * 0.7, ds);
  }

  // Footer
  ctx.fillStyle = 'rgba(255,255,255,0.2)'; ctx.font = '11px -apple-system, sans-serif';
  ctx.fillText('Король и Шут edition', W / 2, H - 40);

  requestAnimationFrame(draw);
}

function drawButton(x, y, w, h, title, subtitle, accent, hover) {
  // Shadow
  ctx.fillStyle = 'rgba(0,0,0,0.3)';
  ctx.beginPath(); ctx.roundRect(x + 2, y + 3, w, h, BTN_R); ctx.fill();
  // Background
  const bgAlpha = hover ? 0.25 : 0.15;
  ctx.fillStyle = `rgba(255,255,255,${bgAlpha})`;
  ctx.beginPath(); ctx.roundRect(x, y, w, h, BTN_R); ctx.fill();
  // Border
  ctx.strokeStyle = hover ? accent : 'rgba(255,255,255,0.15)';
  ctx.lineWidth = hover ? 2 : 1;
  ctx.beginPath(); ctx.roundRect(x, y, w, h, BTN_R); ctx.stroke();
  // Accent bar left
  ctx.fillStyle = accent;
  ctx.beginPath(); ctx.roundRect(x, y, 6, h, [BTN_R, 0, 0, BTN_R]); ctx.fill();
  // Title
  ctx.textAlign = 'left'; ctx.textBaseline = 'middle';
  ctx.fillStyle = '#fff'; ctx.font = 'bold 20px -apple-system, sans-serif';
  ctx.fillText(title, x + 85, y + h / 2 - 10);
  // Subtitle
  ctx.fillStyle = 'rgba(255,255,255,0.45)'; ctx.font = '13px -apple-system, sans-serif';
  ctx.fillText(subtitle, x + 85, y + h / 2 + 14);
  ctx.textAlign = 'center';
}

// ── Input ──
function canvasCoords(e) {
  const rect = canvas.getBoundingClientRect();
  const t = e.touches ? e.touches[0] : e;
  return { x: (t.clientX - rect.left) / rect.width * W, y: (t.clientY - rect.top) / rect.height * H };
}

function hitTest(cx, cy) {
  if (cx >= BTN_X && cx <= BTN_X + BTN_W) {
    if (cy >= BTN1_Y && cy <= BTN1_Y + BTN_H) return 1;
    if (cy >= BTN2_Y && cy <= BTN2_Y + BTN_H) return 2;
    if (cy >= BTN3_Y && cy <= BTN3_Y + BTN_H) return 3;
  }
  return 0;
}

canvas.addEventListener('touchstart', e => {
  e.preventDefault();
  const c = canvasCoords(e);
  const btn = hitTest(c.x, c.y);
  if (btn === 1) window.location.href = 'flappy.html';
  if (btn === 2) window.location.href = 'runner.html';
  if (btn === 3) window.location.href = 'doodle.html';
}, { passive: false });

canvas.addEventListener('mousedown', e => {
  const c = canvasCoords(e);
  const btn = hitTest(c.x, c.y);
  if (btn === 1) window.location.href = 'flappy.html';
  if (btn === 2) window.location.href = 'runner.html';
  if (btn === 3) window.location.href = 'doodle.html';
});

canvas.addEventListener('mousemove', e => {
  const c = canvasCoords(e);
  hoverBtn = hitTest(c.x, c.y) || null;
  canvas.style.cursor = hoverBtn ? 'pointer' : 'default';
});

draw();
</script>
</body>
</html>
